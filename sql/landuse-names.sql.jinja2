WITH landuse AS (
SELECT
    (ST_MaximumInscribedCircle(way)).center AS way,
    name,
    CASE
      WHEN amenity = 'school' THEN 'education'
      WHEN landuse IN ('residential', 'commercial', 'retail', 'industrial', 'education') THEN landuse
    END as landuse,
    way_area
  FROM planet_osm_polygon
  WHERE way && {{bbox}}
    AND (landuse IN ('residential', 'commercial', 'retail', 'industrial')
      OR amenity IN ('school'))
    AND name IS NOT NULL
)
SELECT
    ST_AsMVTGeom(way, {{unbuffered_bbox}}, {{extent}}, {{buffer}}) AS way,
    name,
    landuse,
    way_area
  FROM landuse
