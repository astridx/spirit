WITH landuse AS (
SELECT
    way,
    CASE
      WHEN leisure IN ('park', 'stadium') THEN 'park'
      WHEN amenity = 'school' THEN 'education'
      WHEN landuse IN ('residential', 'commercial', 'retail', 'industrial', 'education') THEN landuse
    END as landuse
  FROM planet_osm_polygon
  WHERE way && {{bbox}}
    AND (landuse IN ('residential', 'commercial', 'retail', 'industrial')
      OR amenity IN ('school')
      OR leisure IN ('park', 'stadium'))
)
SELECT
    ST_AsMVTGeom(ST_Collect(way), {{unbuffered_bbox}}, {{extent}}, {{buffer}}) AS way,
    landuse
  FROM landuse
  GROUP BY landuse
